version: "3.6"
volumes:
  shared-workspace:
    name: "hadoop-distributed-file-system"
    driver: local
services:
  jupyterlab:
    image: jupyterlab-${JUPYTERLAB_VERSION}:spark-${SPARK_VERSION}
    container_name: jupyterlab
    ports:
      - 8888:8888
      - 4040:4040
    volumes:
      # - shared-workspace:/opt/workspace
      - ../src/:/opt/workspace/src/
  spark-master:
    image: spark-master:${SPARK_VERSION}
    container_name: spark-master
    ports:
      - 8080:8080
      - 7077:7077
    volumes:
      - shared-workspace:/opt/workspace
  spark-worker-1:
    image: spark-worker:${SPARK_VERSION}
    container_name: spark-worker-1
    environment:
      - SPARK_WORKER_CORES=1
      - SPARK_WORKER_MEMORY=512m
    ports:
      - 8081:8081
    volumes:
      - shared-workspace:/opt/workspace
    depends_on:
      - spark-master
  spark-worker-2:
    image: spark-worker:${SPARK_VERSION}
    container_name: spark-worker-2
    environment:
      - SPARK_WORKER_CORES=1
      - SPARK_WORKER_MEMORY=512m
    ports:
      - 8082:8081
    volumes:
      - shared-workspace:/opt/workspace
    depends_on:
      - spark-master

  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    ports:
      - 22181:2181
  
  kafka:
    image: confluentinc/cp-kafka:latest
    depends_on:
      - zookeeper
    ports:
      - 29092:29092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1   

  dbeaver:
    image: dbeaver/cloudbeaver:latest
    container_name: cloudbeaver
    ports:
      - 8978:8978
    volumes:
      - /var/cloudbeaver/workspace:/opt/cloudbeaver/workspace

  jenkins:
    image: jenkins/jenkins:lts
    privileged: true
    user: root
    ports:
     - 8070:8080
     - 50000:50000
    container_name: jenkins
    volumes:
     - ../jenkins_configuration:/var/jenkins_home

  jenkins-agent:
    image: jenkins-lts
    privileged: true
    user: root
    container_name: jenkins-agent
    environment:
     - JENKINS_AGENT_SSH_PUBKEY=ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCqL2kvtcffPc4FGBs6lULpelDCdGlFZZaruJMPr9yruwiRHtppPI61CUoUBlAPR9LRIDreYMpl1KXxnTryxBCDyZ+xvTwjpuTaEcUmCT8dPSvzh9GtYwlWSPGBT2f8U4apIZBeNbMPxCPfbE0ze4EEzJfGC9nLMLbGtLQCwL7tZLh1ajl5/pBV+FzYhjGBHtQe/VdE0o4+8l6+j/4KZqdG4k9KUQRvfGKobSEj85iDC07H/aEIl/atE3o1Cr0dwmQH/T4pWjrdfYHaRsTQRzsh9AYNzbgQYepVstfARnMJft7F5BzKRssGctCi+75mEDrsUu6y0iVkicH6jfX2tUSRPTAxxJKY1yBL8A9L6tY+5RwK+Jlz0I0Hrs/w58MNto6+oLOm397z0AXx0hzgKu8a0KpUxd4bhQQ875RB/wqxTIv9Y3pkksZo/IO9plN4ZENFnbZN1+H0Z1deecpgdQU1Wf0I4kqRCDWtY/UypjP4Tt7V5cf7AYBKqL3TRWcGUD0= root@34ef1a36a2c6